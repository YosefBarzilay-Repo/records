<!DOCTYPE html>
<html dir="rtl" lang="he">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Feeling Good - רשומה חדשה</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <!-- Slim Select CSS -->
    <link href="https://unpkg.com/slim-select@latest/dist/slimselect.css" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#13a4ec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101c22",
                    },
                    fontFamily: {
                        "display": ["Heebo", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.5rem", "lg": "0.75rem", "xl": "1rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }
    </style>
    <style>
        .material-symbols-outlined.filled {
            font-variation-settings: 'FILL' 1;
        }

        /* Slim-select dark mode styles */
        .dark .ss-main {
            background-color: #1e293b;
            border-color: #334155;
            color: #cbd5e1;
        }

        .dark .ss-multi-selected {
            border-color: #334155;
        }

        .dark .ss-content {
            background-color: #1e293b;
            border-color: #334155;
        }

        .dark .ss-search input {
            color: #cbd5e1;
        }

        .dark .ss-option:hover,
        .dark .ss-option.ss-highlighted {
            background-color: #334155;
            color: white;
        }

        .dark .ss-multi-selected .ss-value {
            background-color: #334155;
            /* slate-700 */
            color: #e2e8f0;
            /* slate-200 */
        }

        .distortion-details-content {
            transition: all 0.3s ease-in-out;
            max-height: 0;
            overflow: hidden;
        }
        .distortion-details-content.expanded {
            max-height: 1500px; /* Adjust as needed for long content */
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-800 dark:text-slate-200">
    <div class="flex flex-col min-h-screen">
        <header class="sticky top-0 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-sm z-10">
            <div class="flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-800">
                <div class="w-12">
                    <a href="index.html"
                        class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400">
                        <span class="material-symbols-outlined">arrow_forward</span>
                    </a>
                </div>
                <h1 class="text-xl font-bold text-center text-slate-900 dark:text-white">רשומה חדשה</h1>
                <div class="w-12 flex justify-start">
                </div>
            </div>
        </header>
        <main class="flex-grow p-4 pb-20">
            <div class="max-w-3xl mx-auto w-full">
                <form id="new-record-form" class="space-y-6" novalidate>
                    <div>
                        <label for="automatic-thought"
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">מחשבה
                            אוטומטית</label>
                        <textarea id="automatic-thought" name="automatic-thought" rows="3"
                            class="block w-full rounded-lg border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"></textarea>
                    </div>
                    <div>
                        <div class="flex items-center justify-between mb-1">
                            <label for="cognitive-distortion"
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300">העיוות
                                ההכרני</label>
                            <button type="button" id="show-distortions-info" title="מידע על עיוותים" class="p-1 rounded-full text-primary hover:bg-primary/10">
                                <span class="material-symbols-outlined text-base">info</span>
                            </button>
                        </div>
                        <select id="cognitive-distortion" multiple>
                            <option>הכל או לא כלום</option>
                            <option>הכללה מוגזמת</option>
                            <option>פילטר שכלי</option>
                            <option>פסילת החיובי</option>
                            <option>מסקנות מוטעות - קריאת מחשבות</option>
                            <option>מסקנות מוטעות - ניבוי העתיד</option>
                            <option>העצמה ומזעור</option>
                            <option>חשיבה רגשית</option>
                            <option>צריך ואסור</option>
                            <option>הצמדת תוויות</option>
                            <option>העברה לפסים אישיים</option>
                        </select>
                    </div>
                    <div>
                        <label for="logical-response"
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">תגובה
                            הגיונית</label>
                        <textarea id="logical-response" name="logical-response" rows="5"
                            class="block w-full rounded-lg border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 shadow-sm focus:border-primary focus:ring-primary sm:text-sm"></textarea>
                    </div>
                    <div class="pt-4">
                        <button type="submit"
                            class="w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white font-bold rounded-full shadow-lg hover:bg-primary/90 transition-colors">
                            <span id="save-icon" class="material-symbols-outlined">save</span>
                            <span>שמירת רשומה</span>
                        </button>
                    </div>
                </form>
            </div>
        </main>
        <footer
            class="fixed bottom-0 left-0 right-0 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-sm z-10">
            <div class="flex justify-around p-2 border-t border-slate-200 dark:border-slate-800">
                <a class="flex flex-col items-center justify-center w-1/3 text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors"
                    href="index.html" title="רשומות">
                    <span class="material-symbols-outlined">description</span>
                </a>
                <a class="flex flex-col items-center justify-center w-1/3 text-primary" href="new-record.html" title="רשומה חדשה">
                    <span class="material-symbols-outlined filled">add_circle</span>
                </a>
                <a class="flex flex-col items-center justify-center w-1/3 text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors"
                    href="settings.html" title="הגדרות">
                    <span class="material-symbols-outlined">settings</span>
                </a>
            </div>
        </footer>
        <!-- Distortions Info Modal -->
        <div id="distortions-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-start justify-center p-4 overflow-y-auto">
            <div class="bg-white dark:bg-slate-900 rounded-xl shadow-lg w-full max-w-2xl my-8">
                <div class="sticky top-0 bg-white/90 dark:bg-slate-900/90 backdrop-blur-sm p-4 flex items-center justify-between border-b border-slate-200 dark:border-slate-800 z-10">
                    <h3 class="text-xl font-bold">עיוותים הכרניים: הסברים</h3>
                    <button id="close-distortions-modal" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-700">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div id="distortions-list" class="p-4 space-y-2">
                    <!-- Accordion items will be injected here by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    <!-- Slim Select JS -->
    <script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>
    <script>
        // --- Suppress Tailwind CDN production warning ---
        const originalWarn = console.warn;
        console.warn = function (message) {
            if (message.includes('cdn.tailwindcss.com should not be used in production')) {
                return;
            }
            originalWarn.apply(console, arguments);
        };
        // ---------------------------------------------

        // Basic dark mode persistence MUST run before DOMContentLoaded
        if (localStorage.getItem('darkMode') === 'true' || (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('new-record-form');
            const pageTitle = document.querySelector('h1');
            const submitButtonText = form.querySelector('button[type="submit"] span:not(.material-symbols-outlined)');
            const thoughtInput = document.getElementById('automatic-thought');
            const responseInput = document.getElementById('logical-response');
            const showInfoBtn = document.getElementById('show-distortions-info');
            const distortionsModal = document.getElementById('distortions-modal');
            const closeDistortionsModalBtn = document.getElementById('close-distortions-modal');
            const distortionsListContainer = document.getElementById('distortions-list');

            const distortionSelect = new SlimSelect({
                select: '#cognitive-distortion',
                settings: {
                    placeholderText: 'בחר עיוותים הכרניים',
                    searchText: 'לא נמצאו תוצאות',
                    closeOnSelect: false,
                    showSearch: false,
                }
            });

            const distortionExplanations = [
                { title: 'הכל או לא כלום', content: `<b>(מחשבה דו-קוטבית):</b><br>נטייה למדוד כל דבר בקנה מידה שרירותי קיצוני. צורת הסתכלות של ‘שחור או לבן’, תוך התעלמות מגוני ביניים.<br><br>מחשבות ‘הכל או לא כלום’ הן בסיס למרוץ דמיוני אחר שלמות מוחלטת. מכרסם בך כל העת פחד עמוק מטעות או חוסר שלמות מתוך חשש שתהפוך להיות ‘אפס אפסים’ וחסר כל ערך. לדאבון לב, המציאות אינה מתחשבת בתוכניותיך והיא ממשיכה לזרום כרגיל עלי אדמות – בלתי מושלמת.<br><br><b>לדוגמא:</b> סטודנט מצטיין שהיה רגיל לקבל רק ציון ‘9’, קיבל פעם אחת ‘7’ ומייד החליט: “אני כשלון גמור”.<br><br>הערכת דברים לפי ‘הכל או לא כלום’ אינה מציאותית, שכן אירועי החיים אינם נוטים באופן מוחלט לצד זה או אחר. לא תמצא סביבך את המושלם או את הטיפש הגמור. אף אחד אינו לגמרי יפה או מכוער לחלוטין.<br><br>הסתכל על רצפת החדר בו אתה יושב כעת, האם היא נקייה באופן מוחלט, אבסולוטי? לא. האם על כל סנטימטר נערמות שכבות אבק ולכלוך? לא. לא זה ולא זה. ככל הנראה רמת הניקיון סבירה והרצפה בהחלט תזכה בתואר ‘נקייה’, למרות שלא עברה חיטוי וסטרליזציה ‘מושלמים’.<br><br>המושג ‘שלמות מוחלטת’ הוא תוצר של חשיבה מעוותת.<br><br>אם תנסה בכוח לשייך מצבים או ל’הכל’ או ל’כלום’, תרכוש בכך לעצמך כרטיס מנוי במועדון הדיכאון. גם אם תשקיע מאמצים מרביים לא תוכל לעמוד ברמת ציפיותיך הדמיוניות, ותחושת חוסר הערך שלך תלך ותגבר. במרבית המקרים תעדיף להתכנס מלכתחילה אל תוך שממון ה’כלום’, על פני ניסיון להעפיל אל פסגת ה’כל’ ולהסתכן בספיגת מפח נפש נוסף.` },
                { title: 'הכללה מוגזמת', content: `דבר מה ארע לך, ואתה מחליט שמהיום והלאה כך ימשיך לקרות שוב ושוב, או שכך ארע תמיד בעבר: ההתרחשות מכפילה את עצמה. כיוון שעל פי רוב פועל סגנון חשיבה זה דווקא באירועים שליליים, תרומתו הרבה לדיכאון אינה מפתיעה.<br><br>‘הכללה מוגזמת’ אחראית אף לכאב החריף הנוצר בעקבות דחייה. ללא הכללה מוגזמת מורגשת אמנם אכזבה זמנית, אך זו אינה מובילה לדכדוך עמוק העלול להתפתח עד כדי דיכאון של ממש.<br><br><b>לדוגמה:</b> בחור ביישן אוזר אומץ ומבקש מבחורה לצאת עמו, אולם היא מסרבת בנימוס כי תכננה לעצמה משהו אחר לערב זה.<br><br>כתוצאה מכך חושב הבחור לעצמו: “לעולם לא אצליח ליצור קשר עם בחורה. אף אחת לא תרצה לצאת איתי. כל חיי אשאר בודד ואומלל”.<br><br>ההכללה המוגזמת גורמת לו להסיק שמכיוון ובחורה זו לא יצאה עימו הפעם, כך תנהג אף בהזדמנויות אחרות, ומכיוון שאחת מ’עם הנשים’ לא נענתה לפנייתו, אף אישה אחרת לא תיעתר לו.` },
                { title: 'פילטר שכלי', content: `בסיטואציה המתרחשת עמך, אתה ‘נתפס’ לפרטים שליליים (לפעמים מדובר רק בפרט אחד), על פיהם אתה נוטה לפרש את המצב כולו כשלילי.<br><br><b>לדוגמא:</b> סטודנטית בשם ארלן היתה עדה למקרה, בו קבוצת סטודנטים לעגה בצורה מכוערת לחברתה הטובה ביותר. ארלן כעסה מאוד וחשבה: “האנושות כולה אכזרית ובלתי אכפתית”. משום מה נשכחה ממנה העובדה שבחודשים האחרונים היא פגשה מעט מאוד אנשים, אם בכלל/שהתנהגו בצורה אכזרית או בלתי אכפתית.<br><br>במצב דכאוני אתה מביט על המציאות דרך עדשות מיוחדות, המסננות ומסלקות כל פרט חיובי, ומניחות רק לנתונים שליליים להיכנס להכרתך. מכיוון שאינך מודע לקיומו של תהליך סינון זה, מסקנתך ההגיונית היא שאכן הכל שלילי.` },
                { title: 'פסילת החיובי', content: `זהו כשרון שכלי ‘מרשים’ בהרבה מכל מה שהכרנו עד כה: היכולת להפוך חוויות ניטרליות או אפילו חיוביות, לחוויות שליליות.<br><br>אינך מתעלם מהצדדים החיוביים אלא אתה פשוט הופך אותם בזריזות ובמיומנות להפך הגמור. לסיוט.<br><br>חוויות האמורות להיות נעימות מנותבות על ידך במהירות הבזק למחוזות הקדרות.<br><br>מובן שהדבר אינו נעשה בכוונה תחילה וככל הנראה אינך מודע לכך כלל.<br><br>דוגמא נפוצה מחיי היום יום היא הצורה בה רובנו נוהגים להגיב למחמאות. כאשר מישהו משבח את הופעתך או את יעבודתך אתה נוטה לחשוב: “הוא מנסה להיות נחמד” או: “הוא רוצה לגרום לי הרגשה טובה”, ואתה מרוקן מהמחמאה את תוכנה המהנה.<br><br>‘פסילת החיובי’ היא אחת הצורות ההרסניות ביותר של עיוותים מחשבתיים.<br><br>התיאוריה השולטת במחשבותיך בעת נטייה לדיכאון תהיה בדרך כלל: “אני סוג ב'” בכל פעם שתחווה משהו שלילי, תמהר לחשוב: “הנה עוד הוכחה למה שידעתי כל הזמן”.<br><br>לעומת זאת, כאשר תזדמן לחייך חוויה חיובית תאמר לעצמך: “זה כלום. זה קרה במקרה. זה לא נחשב כלל”.<br><br>אתה משלם על נטייה זו מחיר מופקע של אומללות וחוסר יכולת להעריך את ההתרחשויות היפות של חייך.<br><br>בהחלט יתכן שמדי יום אתה פוסל דברים טובים המתרחשים בחייך, המאבדים כתוצאה מכך חלק ניכר מיופיים והופכים לריקים ועגמומיים.<br><br>כמה חבל !` },
                { title: 'מסקנות מוטעות - קריאת מחשבות', content: `אתה מסיק משום מה שאנשים אחרים אינם מעריכים אותך, ואתה כה משוכנע בכך עד שאינך טורח כלל לבדוק את העובדות.<br><br><b>לדוגמא:</b> בת-זוגך אינה מגיבה לשאלתך: “איך היה בעבודה ?” משום שבדיוק היום נזף בה הבוס ואין לה חשק לדבר על-כך.<br><br>אולם לבך שוקע בגלל התרגום המוענק על ידך לשתיקתה: “היא כועסת עלי. מה עשיתי ?”<br><br>החשיבה התבוסתנית נעשית נבואה המגשימה את עצמה.<br><br>חשיבה זו גורמת לפעולות גומלין שליליות ביחסיך עם הסביבה וכמובן למצב רוח קודר, אף שעובדתית אין לכך כל סיבה אובייקטיבית.<br><br>אתה עלול להגיב למצבים מעין אילו בהתכנסות לתוך עצמך או בהתקפת-נגד.` },
                { title: 'מסקנות מוטעות - ניבוי העתיד', content: `אתה אוחז כביכול מול עיניך כדור בדולח המנבא לך אומללות תמידית. משהו רע עומד לקרות, לפי הרגשתך, ואתה מאמץ ניבוי זה כעובדה למרות שאין לו כל בסיס.<br><br><b>לדוגמא:</b> מארי, ספרנית בבית ספר תיכון נהגה לומר לעצמה בכל עת שנתקפה במתח: “אני עומדת להתעלף או לצאת מדעתי”.<br><br>ניבויים אלו היו בלתי מציאותיים, מכיוון שמארי לעולם לא התעלפה ולא השתגעה למרות אין ספור פעמים שחשבה כך.` },
                { title: 'העצמה ומזעור', content: `מלכודת חשיבתית זו של העצמה ומזעור (הגדלה והקטנה) מכונה: ‘טריק המשקפת’.<br><br>ביצועי ההקצנה שלה הם קוטביים כפי שמסוגלת לעשות רק משקפת-שדה טובה.<br><br>העצמה מתרחשת בעת שאתה חושב על טעויות, חסרונות, או פחדים ומייד מנפח את עוצמתם: “אוי ואבוי, טעיתי, כמה איום ! כמה נורא ! השמועה תתפשט כמו בשדה קוצים ! שמי הטוב הרוס לעולמי-עד !”<br><br>זווית הראייה ממנה בחרת כדי להתבונן בחסרונותייך היא הגורמת להם להיראות ענקיים ומפחידים.<br><br>חוויות שליליות נורמאליות ושגרתיות הופכות להיות סיוט אימתני.<br><br>בניגוד לכך, על חוויות נחמדות ועל מעלותיך אתה מתעקש להביט דרך צידה האחר של המשקפת, ועל כן הם מקבלים ממדים זעירים וחסרי חשיבות.<br><br>אין ספק כי העדשות המעוותות דרכן בחרת להתבונן הן אלו המשמרות את תחושת הנחיתות והדכדוך !` },
                { title: 'חשיבה רגשית', content: `רגשותיך הופכים להיות בעיניך הוכחה למציאות.<br><br>‘הגיון’ זה פועל כך:  “אם אני מרגיש חסר ערך, סימן שכך אני באמת”.<br><br>זו חשיבה מוטעית מסיבה פשוטה: רגשותיך בסך הכל משקפים בבהירות את המתהווה במחשבותיך ואמונותיך.<br><br>כאשר מחשבתך מעוותת – כפי שקורה לעיתים תכופות במיוחד כאשר אתה בדיכאון – רגשותיך משקפים את אותו עיוות.<br><br>אין לרגשות כל תוקף כמהות עצמאית.<br><br>דוגמאות קלאסיות של חשיבה רגשית:<br>“יש לי נקיפות מצפון, כנראה שעשיתי משהו שאינו ראוי”;<br>“אני מרגיש חסר תקווה, מכאן שבעיותיי אינן ניתנות לפתרון”;<br>“אני מרגיש חוסר שייכות, סימן שאני אדם חסר ערך”;<br>“מדוע שלא אשכב במיטה ? הרי לא ‘בא לי’ לעשות כלום וזה סימן שבאמת אינני מסוגל להזיז את עצמי”;<br>“אני מרגיש כעס עליך והדבר מוכיח שהתנהגת אלי בצורה בלתי הוגנת מתוך ניסיון לנצל אותי”.<br><br>לחשיבה הרגשית שמור תפקיד מרכזי ברוב מקרי הדיכאון.<br><br>אתה מניח שהמצב הוא אכן גרוע כפי שאתה מרגיש, ואינך חושב לרגע לערער על ההנחות שגרמו להרגשה זו.<br><br>אחת מתופעות הלוואי של חשיבה רגשית מתבטאת בנטייה לדחות מטלות.<br><br>אתה מתחמק מלסדר את שולחנך כי: “רק מחשבה על השולחן המבולגן גורמת לי הרגשה כה גרועה. אני בטוח שלא אוכל לסדר אותו”.<br><br>אם לאחר חצי שעה נוספת תכריח את עצמך לעשות סדר, תיווכח לדעת שלא מדובר ב’סוף העולם’ ואפילו תחוש סיפוק רב למראה התוצאות. המציאות טופחת על פניך: רימית את עצמך לכל אורך הדרך בגלל שהנחת ל’חשיבה הרגשית’ לכוון את התנהגותך.` },
                { title: 'צריך ואסור', content: `משפטי ‘צריך’ מחוללים מהומות רבות בחיי היום-יום. כאשר המציאות אינה תואמת לרף שקבעת לעצמך, יוצרים ה’צריך’ וה’אסור’ שאתה מטיח בעצמך שנאה עצמית, בושה ונקיפות מצפון.<br><br>גם התנהגותם של אחרים לא תענה תמיד על ציפיותיך, ואז יופנו ה’צריך’ וה’אסור’ כלפיהם כשאתה מסתגר בקונכיה של ‘קדוש מעונה’ ו’מתבשל’ בזעם כבוש על העולם.<br><br>הניסיון לדרבן את עצמך לפעילות באמצעות הנחיות פנימיות של: “אני צריך…” או: “אני חייב…” גורם לחץ והתמרמרות והם מובילים, באופן פרדוכסלי, דווקא לאדישות וחוסר מוטיבציה.<br><br>למשפטי “צריך” המופנים כלפי אחרים מתלווה לרוב תחושת תסכול עזה. ההרגשה ש’הם’ היו ‘צריכים’ לעשות דבר-מה ולמרות זאת עשו אחרת, נגדך, תיצור בך תחושה חמוצה ביותר.<br><br>לדוגמא, פעם בשל מקרה חירום מטפל איחר בחמש דקות לפגישה עם מטופלת חדשה. בקמצוץ זמן זה הספיקה המטופלת לחשוב: “אסור לו להיות כל כך אנוכי וחסר התחשבות, הוא צריך לדייק בזמנים”. היא נעשתה כה ממורמרת עד שבמהלך הפגישה כמעט ולא היה עם מי לדבר.<br><br>אם אינך מעוניין להעביר את חייך בהתמרמרות דכאונית, יהיה עליך לשנות את ‘כללי ההתנהגות’ שקבעת לעצמך או עבור האנשים שסביבך.` },
                { title: 'הצמדת תוויות', content: `הצמדת תוויות היא צורה קיצונית של הכללת יתר.<br><br>אתה יוצר לעצמך דמות שלילית מוחלטת בגלל טעויות שביצעת.<br><br>ה’פילוסופיה’ העומדת מאחורי הרעיון היא: ‘שגיאות שביצעתי מורים על הערך האמיתי שלי’.<br><br>כישלונות נתפסים בעיניך כמשקפי מהותך האמיתית.<br><br>לאחר הפסד במשחק טניס תחשוב: “נולדתי עם שתי ידיים שמאליות” במקום: “לא הצלחתי הפעם”.<br><br>הצמדת כינוי בשל התרחשות מסוימת היא חסרת הגיון לחלוטין.<br>חייך הם זרם בלתי פוסק ומשתנה של מחשבות, רגשות, ומעשים, הם מזכירים נהר שופע ולא פסל יצוק.<br>יש אותך ויש את שטף הפעולות שאתה מבצע, אינך מכונה על שם פעולותיך.<br>האם תקרא לעצמך ‘אכלן’ בגלל מנהגך לאכול ? או אולי ‘נשמן’ בגלל שאתה נושם ? או ‘דברן’ או ‘ישנן’ ?<br>אלו ודאי שטויות, אולם שטויות אלו עלולות להיות מכאיבות ביותר כאשר אתה קובע לעצמך ‘זהות’ לפי מעשה שלילי שביצעת.<br><br>גרועה לא פחות היא הצמדת תוויות לאנשים אחרים, היוצרת תגובה בלתי נמנעת של עוינות.<br><br>לדוגמא: ‘בוס’ עלול להצמיד למזכירתו העצבנית במקצת תווית של ‘רשלנית ובלתי ממושמעת’, ובעקבות כך יכעס עליה בתמידיות וינצל כל הזדמנות למתיחת ביקורת.<br>כתוצאה מהתנהגותו, מגדירה אותו המזכירה כ’שוביניסט חסר רגש’ ומרכלת עליו בכל העיר.<br>שניהם לכודים במעגל בו כל אחד מתמקד בחסרון מסוים של השני – כדי להוכיח את חוסר הערך הכללי שלו.<br><br>ההרגל להצמיד תוויות גורם להגזמה בתיאור של כל אירוע ויוצר אוירה טעונה.<br><br>לדוגמא: אישה שאוכלת צלוחית גלידה באמצע תקופת דיאטה מצליפה בעצמה: “כמה מגעיל מה שעשיתי ! אני ממש חזירה. שברתי את הדיאטה”.<br><br>מחשבות אילו מציקות לה עד כדי כך עד שהדבר היחיד שיצליח לשפר את הרגשתה הוא חבילת הגלידה כולה.` },
                { title: 'העברה לפסים אישיים', content: `עיוות זה הוא אבי אבות רגשי האשמה. הוא דוחף אותך לקחת אחריות על דברים שליליים גם כאשר אין לכך סיבה.<br>אתה מסיק בטעות שהאירוע נגרם באשמתך או משקף חוסר יכולת שלך.<br><br><b>לדוגמא:</b> אם קיבלה פתק מהמורה של בנה, המודיע לה כי הילד אינו מתפקד כראוי בבית הספר.<br>תגובתה המיידית היתה: “כנראה אני אמא רעה. זה מוכיח שנכשלתי”.<br><br>רגשי האשמה הנוצרים מ’העברה לפסים אישיים’ משתקים לחלוטין.<br>אתה נמחץ תחת תחושת אחריות כבדה, שכמו מכריחה אותך לסחוב את כל העולם על כתפיך.<br>אתה מאבד את הקו המפריד בין ‘השפעה’ על אחרים לבין ‘שליטה’ עליהם.<br>אמנם בתפקידך כמורה, בן-זוג, רופא, מדריך, ידיד, איש מכירות, איש עסקים, מוקרנת ממך השפעה על האנשים עמם אתה בא במגע, אולם אינך שולט על אף אחד מהם.<br>בסופו של דבר, האחריות על מה שמישהו אחר עשה מוטלת עליו ולא עליך.` },
            ];

            // --- Modal Logic ---
            function toggleDistortionsModal(show) {
                if (show) {
                    distortionsModal.classList.remove('hidden');
                    distortionsModal.classList.add('flex');
                } else {
                    distortionsModal.classList.add('hidden');
                    distortionsModal.classList.remove('flex');
                }
            }

            function populateDistortionsInfo() {
                distortionsListContainer.innerHTML = '';
                distortionExplanations.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'distortion-item border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden';
                    div.innerHTML = `
                        <button type="button" class="distortion-header w-full text-right p-4 flex justify-between items-center hover:bg-slate-50 dark:hover:bg-slate-800">
                            <span class="font-bold">${item.title}</span>
                            <span class="material-symbols-outlined transition-transform">expand_more</span>
                        </button>
                        <div class="distortion-details-content">
                            <div class="p-4 border-t border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 space-y-2">
                                <p>${item.content}</p>
                            </div>
                        </div>
                    `;
                    distortionsListContainer.appendChild(div);
                });
            }

            distortionsListContainer.addEventListener('click', (e) => {
                const header = e.target.closest('.distortion-header');
                if (header) {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.material-symbols-outlined');
                    const isExpanded = content.classList.contains('expanded');

                    // Optional: Close other open items
                    // distortionsListContainer.querySelectorAll('.distortion-details-content.expanded').forEach(openContent => {
                    //     if (openContent !== content) {
                    //         openContent.classList.remove('expanded');
                    //         openContent.previousElementSibling.querySelector('.material-symbols-outlined').style.transform = 'rotate(0deg)';
                    //     }
                    // });

                    content.classList.toggle('expanded');
                    icon.style.transform = isExpanded ? 'rotate(0deg)' : 'rotate(180deg)';
                }
            });

            showInfoBtn.addEventListener('click', () => toggleDistortionsModal(true));
            closeDistortionsModalBtn.addEventListener('click', () => toggleDistortionsModal(false));
            distortionsModal.addEventListener('click', (e) => {
                if (e.target === distortionsModal) {
                    toggleDistortionsModal(false);
                }
            });

            populateDistortionsInfo();
            // --------------------

            // Set the data for the dropdown on initial load for new records as well.
            const allDistortions = Array.from(document.querySelectorAll('#cognitive-distortion option')).map(opt => ({ text: opt.value }));
            distortionSelect.setData(allDistortions);

            const urlParams = new URLSearchParams(window.location.search);
            const editRecordId = urlParams.get('id');
            let records = JSON.parse(localStorage.getItem('thoughtRecords')) || [];

            if (editRecordId) {
                const recordToEdit = records.find(record => record.id.toString() === editRecordId);
                if (recordToEdit) {
                    pageTitle.textContent = 'עריכת רשומה';
                    submitButtonText.textContent = 'שמירת שינויים';

                    thoughtInput.value = recordToEdit.thought;
                    responseInput.value = recordToEdit.response;

                    // When editing, we must first set the full data set, then set the selected values.
                    const distortions = Array.isArray(recordToEdit.distortion) ? recordToEdit.distortion : [];
                    distortionSelect.setSelected(distortions);
                }
            }

            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const thought = thoughtInput.value;
                const distortion = distortionSelect.getSelected(); // Get array of selected string values
                const response = responseInput.value;

                if (editRecordId) {
                    // Update existing record
                    const recordIndex = records.findIndex(record => record.id.toString() === editRecordId);
                    if (recordIndex > -1) {
                        records[recordIndex].thought = thought;
                        records[recordIndex].distortion = distortion;
                        records[recordIndex].response = response;
                    }
                } else {
                    // Create new record
                    const newRecord = {
                        id: Date.now(),
                        thought: thought,
                        distortion: distortion,
                        response: response,
                        createdAt: new Date().toISOString()
                    };
                    records.unshift(newRecord); // Add new record to the beginning
                }

                localStorage.setItem('thoughtRecords', JSON.stringify(records));
                window.location.assign('index.html');
            });
        });
    </script>
</body>

</html>